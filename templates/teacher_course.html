{% extends "base.html" %}
{% block title %}{% if course %}{{ course.title }} - 编辑{% else %}创建新课程{% endif %}{% endblock %}
{% block content %}
<h2>{% if course %}{{ course.title }} - 编辑课程{% else %}创建新课程{% endif %}</h2>
<form method="POST" action="{% if course %}{{ url_for('edit_course', course_id=course.id) }}{% else %}{{ url_for('create_course') }}{% endif %}" enctype="multipart/form-data">
    <div class="form-group">
        <label for="title">课程标题</label>
        <input type="text" id="title" name="title" class="form-control" value="{% if course %}{{ course.title }}{% endif %}" required>
    </div>
    <div class="form-group">
        <label for="description">课程描述</label>
        <textarea id="description" name="description" class="form-control" rows="5">{% if course %}{{ course.description }}{% endif %}</textarea>
    </div>

    <!-- 视频上传区域 -->
    <div class="form-group mt-6">
        <h3 class="text-lg font-semibold mb-3">课程视频</h3>
        <div class="card p-6 border-2 border-dashed border-gray-300 rounded-lg hover:border-primary transition-colors">
            <div class="text-center">
                <i class="fa fa-video-camera text-4xl text-gray-400 mb-4"></i>
                <p class="text-gray-500 mb-2">点击或拖拽视频文件到此处上传</p>
                <p class="text-xs text-gray-400">支持 MP4, WebM, OGG 格式，最大 1GB</p>
                <input type="file" id="video" name="video" accept="video/*" class="hidden">
                <button type="button" onclick="document.getElementById('video').click()" class="btn mt-4">选择视频文件</button>
            </div>
            {% if course and course.video_filename %}
            <div class="mt-4">
                <p class="text-sm text-gray-600">当前视频: {{ course.video_filename }}</p>
                <div class="mt-2">
                    <video width="100%" height="200" controls poster="https://picsum.photos/400/225?random={{ course.id }}">
                        <source src="{{ url_for('play_video', filename=course.video_filename) }}" type="video/mp4">
                        你的浏览器不支持视频播放
                    </video>
                </div>
            {% endif %}
        </div>
    </div>

    <div class="form-group text-center">
        <button type="submit" class="btn">{% if course %}更新课程{% else %}创建课程{% endif %}</button>
    </div>
</form>

<!-- 添加查看学生数据链接 -->
{% if course %}
<div class="mt-3 flex justify-between items-center">
    <a href="{{ url_for('view_student_data', course_id=course.id) }}" class="text-sm text-gray-600 hover:text-primary">
        <i class="fa fa-users mr-1"></i> 查看学生数据
    </a>
</div>
{% endif %}

{% endblock %}
{% extends "base.html" %}

{% block title %}考试结果 - {{ exam.title }}{% endblock %}

{% block content %}
<div class="container mt-4">
  <h3 class="mb-4">{{ exam.title }} - 考试结果</h3>
  <div class="mb-3">
    <strong>得分：</strong> {{ result.score }} / {{ total_score }}
  </div>
  <div class="mb-4">
    <strong>提交时间：</strong> {{ result.submission_time.strftime('%Y-%m-%d %H:%M:%S') }}
  </div>
  {% for question in questions %}
    {% set user_ans = student_answers.get(question.id|string) %}
    {% set is_correct = is_correct_map.get(question.id|string, false) %}
    <div class="card mb-3">
      <div class="card-header bg-light d-flex justify-content-between align-items-center">
        <div>
          <strong>第{{ loop.index }}题：</strong> {{ question.question_text }}
        </div>
        <span class="badge {% if is_correct %}bg-success{% else %}bg-danger{% endif %} text-white">
          分值：{{ question.score }}
        </span>
      </div>
      <div class="card-body">
        <div>
          <strong>你的答案：</strong>
          {% if question.question_type == 'judge' %}
            {% if student_answers.get(question.id|string) == 'A' %}正确{% elif student_answers.get(question.id|string) == 'B' %}错误{% else %}未作答{% endif %}
          {% else %}
            {{ format_answer(student_answers[question.id|string], question.question_type) if student_answers.get(question.id|string) else '未作答' }}
          {% endif %}
        </div>
        <div>
          <strong>标准答案：</strong>
          {% if question.question_type == 'judge' %}
            {% if question.correct_answer == 'A' %}正确{% elif question.correct_answer == 'B' %}错误{% else %}{{ question.correct_answer }}{% endif %}
          {% else %}
            {{ format_answer(question.correct_answer, question.question_type) }}
          {% endif %}
        </div>
        {% if question.explanation %}
        <div class="mt-2">
          <strong>解析：</strong> {{ question.explanation }}
        </div>
        {% endif %}
      </div>
    </div>
  {% endfor %}
</div>
{% endblock %}
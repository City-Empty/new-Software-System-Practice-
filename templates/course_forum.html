<!-- templates/course_forum.html -->
{% extends "base.html" %}
{% block title %}论坛{% endblock %}
{% block content %}
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold mb-6">论坛</h1>

        <!-- 发帖表单 -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4">发布新帖</h2>
            <form method="POST" action="{{ url_for('course_forum') }}">
                <div class="mb-4">
                    <label for="title" class="block text-gray-700 font-medium mb-2">标题</label>
                    <input type="text" id="title" name="title" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                </div>
                <div class="mb-4">
                    <label for="content" class="block text-gray-700 font-medium mb-2">内容</label>
                    <textarea id="content" name="content" rows="4" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required></textarea>
                </div>
                <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-md transition duration-300">发布</button>
            </form>
        </div>

        <!-- 帖子列表 -->
        <div class="space-y-6">
            {% for post in forum_posts %}
            <div class="bg-white rounded-lg shadow-md overflow-hidden">
                <div class="p-6">
                    <div class="flex items-center mb-3">
                        <img src="https://picsum.photos/id/{{ post.user.id }}/40/40" alt="用户头像" class="w-10 h-10 rounded-full mr-3">
                        <div>
                            <h3 class="font-semibold text-lg">{{ post.user.username }}</h3>
                            <p class="text-gray-500 text-sm">{{ post.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
                        </div>
                    </div>
                    <h4 class="text-xl font-semibold mb-2">{{ post.title }}</h4>
                    <p class="text-gray-700 mb-4">{{ post.content }}</p>

                    <!-- 回帖表单 -->
                    <div class="mt-6 bg-gray-50 p-4 rounded-lg">
                        <h5 class="font-medium mb-3">发表回复</h5>
                        <form method="POST" action="{{ url_for('reply_to_post', post_id=post.id) }}">
                            <textarea name="content" rows="2" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required></textarea>
                            <button type="submit" class="mt-2 bg-blue-500 hover:bg-blue-600 text-white font-medium py-1 px-3 rounded-md text-sm transition duration-300">回复</button>
                        </form>
                    </div>

                    <!-- 回帖列表 -->
                    <div class="mt-6 space-y-4">
                        {% for reply in post.replies %}
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <div class="flex items-center mb-2">
                                <img src="https://picsum.photos/id/{{ reply.user.id }}/32/32" alt="用户头像" class="w-8 h-8 rounded-full mr-2">
                                <div>
                                    <h6 class="font-medium text-sm">{{ reply.user.username }}</h6>
                                    <p class="text-gray-500 text-xs">{{ reply.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
                                </div>
                            </div>
                            <p class="text-gray-700 text-sm">{{ reply.content }}</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
{% endblock %}